<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            animation: slideDown 0.5s ease;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }

        .control-group select, .control-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .control-group select:focus, .control-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-refresh {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            align-self: flex-end;
        }

        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .chart-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .map-container {
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: white;
            font-size: 1.2em;
        }

        .loading.active {
            display: block;
        }

        @media (max-width: 768px) {
            .grid-container {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>üìà Global Stock Market Dashboard</h1>
            <p>Real-time analysis of world stock prices and market trends</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="monthSelect">Select Month</label>
                <select id="monthSelect">
                    <option value="2024-01">January 2024</option>
                    <option value="2024-02">February 2024</option>
                    <option value="2024-03">March 2024</option>
                    <option value="2024-04">April 2024</option>
                    <option value="2024-05">May 2024</option>
                    <option value="2024-06">June 2024</option>
                    <option value="2024-07">July 2024</option>
                    <option value="2024-08">August 2024</option>
                    <option value="2024-09">September 2024</option>
                    <option value="2024-10" selected>October 2024</option>
                </select>
            </div>
            <div class="control-group">
                <label for="industryFilter">Industry Filter</label>
                <select id="industryFilter">
                    <option value="all">All Industries</option>
                    <option value="tech">Technology</option>
                    <option value="finance">Finance</option>
                    <option value="healthcare">Healthcare</option>
                    <option value="retail">Retail</option>
                    <option value="energy">Energy</option>
                </select>
            </div>
            <button class="btn-refresh" onclick="refreshDashboard()">üîÑ Refresh Data</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalCompanies">150</div>
                <div class="stat-label">Total Companies</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgPrice">$245.67</div>
                <div class="stat-label">Average Stock Price</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalVolume">8.2B</div>
                <div class="stat-label">Total Volume</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="marketTrend">+2.3%</div>
                <div class="stat-label">Market Trend</div>
            </div>
        </div>

        <div class="loading" id="loading">Loading data...</div>

        <div class="grid-container">
            <div class="chart-card">
                <h3 class="chart-title">üìä Monthly Price Variation</h3>
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">üèÜ Top 10 Companies (Current Month Avg)</h3>
                <div class="chart-container">
                    <canvas id="topCompaniesChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">üìâ Bottom 10 Companies (Current Month Avg)</h3>
                <div class="chart-container">
                    <canvas id="bottomCompaniesChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h3 class="chart-title">üåê Top 10 Companies Locations</h3>
                <div class="map-container" id="map"></div>
            </div>
        </div>

        <div class="chart-card" style="grid-column: 1 / -1;">
            <h3 class="chart-title">üìà Animated Stock Price Fluctuations</h3>
            <div class="chart-container" style="height: 400px;">
                <canvas id="animatedChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Sample data generation (simulating real stock data)
        const companies = [
            {name: 'Apple Inc.', ticker: 'AAPL', industry: 'Technology', country: 'USA', lat: 37.3318, lng: -122.0296},
            {name: 'Microsoft Corp.', ticker: 'MSFT', industry: 'Technology', country: 'USA', lat: 47.6062, lng: -122.3321},
            {name: 'Amazon.com Inc.', ticker: 'AMZN', industry: 'Retail', country: 'USA', lat: 47.6062, lng: -122.3321},
            {name: 'Alphabet Inc.', ticker: 'GOOGL', industry: 'Technology', country: 'USA', lat: 37.4220, lng: -122.0841},
            {name: 'Tesla Inc.', ticker: 'TSLA', industry: 'Automotive', country: 'USA', lat: 37.3947, lng: -122.1498},
            {name: 'NVIDIA Corp.', ticker: 'NVDA', industry: 'Technology', country: 'USA', lat: 37.3708, lng: -121.9959},
            {name: 'Meta Platforms', ticker: 'META', industry: 'Technology', country: 'USA', lat: 37.4850, lng: -122.1473},
            {name: 'Berkshire Hathaway', ticker: 'BRK.A', industry: 'Finance', country: 'USA', lat: 41.2565, lng: -95.9345},
            {name: 'JPMorgan Chase', ticker: 'JPM', industry: 'Finance', country: 'USA', lat: 40.7128, lng: -74.0060},
            {name: 'Johnson & Johnson', ticker: 'JNJ', industry: 'Healthcare', country: 'USA', lat: 40.4968, lng: -74.4444},
            {name: 'Visa Inc.', ticker: 'V', industry: 'Finance', country: 'USA', lat: 37.5569, lng: -122.2828},
            {name: 'Procter & Gamble', ticker: 'PG', industry: 'Consumer Goods', country: 'USA', lat: 39.1031, lng: -84.5120},
            {name: 'UnitedHealth Group', ticker: 'UNH', industry: 'Healthcare', country: 'USA', lat: 44.9778, lng: -93.2650},
            {name: 'Home Depot', ticker: 'HD', industry: 'Retail', country: 'USA', lat: 33.7490, lng: -84.3880},
            {name: 'Mastercard Inc.', ticker: 'MA', industry: 'Finance', country: 'USA', lat: 41.0382, lng: -73.5413},
            {name: 'Pfizer Inc.', ticker: 'PFE', industry: 'Healthcare', country: 'USA', lat: 40.7128, lng: -74.0060},
            {name: 'Walmart Inc.', ticker: 'WMT', industry: 'Retail', country: 'USA', lat: 36.3729, lng: -94.2088},
            {name: 'Chevron Corp.', ticker: 'CVX', industry: 'Energy', country: 'USA', lat: 37.9265, lng: -122.5270},
            {name: 'Eli Lilly', ticker: 'LLY', industry: 'Healthcare', country: 'USA', lat: 39.7684, lng: -86.1581},
            {name: 'ExxonMobil', ticker: 'XOM', industry: 'Energy', country: 'USA', lat: 32.8893, lng: -97.0362}
        ];

        // Generate sample stock data
        function generateStockData() {
            const data = [];
            companies.forEach(company => {
                const basePrice = Math.random() * 500 + 50;
                for (let i = 0; i < 30; i++) {
                    const variation = (Math.random() - 0.5) * 20;
                    data.push({
                        company: company.name,
                        ticker: company.ticker,
                        industry: company.industry,
                        country: company.country,
                        lat: company.lat,
                        lng: company.lng,
                        date: new Date(2024, 9, i + 1),
                        open: basePrice + variation,
                        high: basePrice + variation + Math.random() * 10,
                        low: basePrice + variation - Math.random() * 10,
                        close: basePrice + variation + (Math.random() - 0.5) * 5,
                        volume: Math.floor(Math.random() * 10000000) + 1000000
                    });
                }
            });
            return data;
        }

        const stockData = generateStockData();

        // Initialize charts
        let monthlyChart, topCompaniesChart, bottomCompaniesChart, animatedChart, map;

        function initCharts() {
            // Monthly Price Variation Bar Chart
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            monthlyChart = new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Average Daily Price',
                        data: [],
                        backgroundColor: 'rgba(102, 126, 234, 0.7)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 8,
                        hoverBackgroundColor: 'rgba(118, 75, 162, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Top Companies Pie Chart
            const topCtx = document.getElementById('topCompaniesChart').getContext('2d');
            topCompaniesChart = new Chart(topCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                            '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 1500
                    },
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 10,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': $' + context.parsed.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });

            // Bottom Companies Pie Chart
            const bottomCtx = document.getElementById('bottomCompaniesChart').getContext('2d');
            bottomCompaniesChart = new Chart(bottomCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                            '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 1500
                    },
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 10,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': $' + context.parsed.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });

            // Animated Line Chart
            const animatedCtx = document.getElementById('animatedChart').getContext('2d');
            animatedChart = new Chart(animatedCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            cornerRadius: 8
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            },
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Initialize Map
            map = L.map('map').setView([39.8283, -98.5795], 4);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
        }

        function updateDashboard() {
            const selectedMonth = document.getElementById('monthSelect').value;
            const selectedIndustry = document.getElementById('industryFilter').value;

            // Filter data based on selections
            let filteredData = stockData;
            if (selectedIndustry !== 'all') {
                filteredData = stockData.filter(d => d.industry.toLowerCase() === selectedIndustry);
            }

            // Update Monthly Chart
            const dailyAverages = {};
            for (let i = 1; i <= 30; i++) {
                const dayData = filteredData.filter(d => d.date.getDate() === i);
                if (dayData.length > 0) {
                    dailyAverages[i] = dayData.reduce((sum, d) => sum + d.close, 0) / dayData.length;
                }
            }

            monthlyChart.data.labels = Object.keys(dailyAverages).map(d => `Day ${d}`);
            monthlyChart.data.datasets[0].data = Object.values(dailyAverages);
            monthlyChart.update();

            // Calculate company averages
            const companyAverages = {};
            companies.forEach(company => {
                const companyData = filteredData.filter(d => d.company === company.name);
                if (companyData.length > 0) {
                    companyAverages[company.name] = {
                        avg: companyData.reduce((sum, d) => sum + d.close, 0) / companyData.length,
                        lat: company.lat,
                        lng: company.lng,
                        ticker: company.ticker
                    };
                }
            });

            // Sort companies by average price
            const sortedCompanies = Object.entries(companyAverages)
                .sort((a, b) => b[1].avg - a[1].avg);

            // Update Top 10 Companies Chart
            const top10 = sortedCompanies.slice(0, 10);
            topCompaniesChart.data.labels = top10.map(c => c[0].split(' ')[0]);
            topCompaniesChart.data.datasets[0].data = top10.map(c => c[1].avg);
            topCompaniesChart.update();

            // Update Bottom 10 Companies Chart
            const bottom10 = sortedCompanies.slice(-10).reverse();
            bottomCompaniesChart.data.labels = bottom10.map(c => c[0].split(' ')[0]);
            bottomCompaniesChart.data.datasets[0].data = bottom10.map(c => c[1].avg);
            bottomCompaniesChart.update();

            // Update Map Markers
            map.eachLayer(layer => {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });

            top10.forEach((company, index) => {
                const companyInfo = companyAverages[company[0]];
                const marker = L.marker([companyInfo.lat, companyInfo.lng])
                    .addTo(map)
                    .bindPopup(`
                        <strong>${company[0]}</strong><br>
                        Ticker: ${companyInfo.ticker}<br>
                        Rank: #${index + 1}<br>
                        Avg Price: $${companyInfo.avg.toFixed(2)}
                    `);
                
                if (index === 0) {
                    marker.openPopup();
                }
            });

            // Update Animated Chart
            const topCompaniesForAnimation = sortedCompanies.slice(0, 5);
            const dates = [...new Set(filteredData.map(d => d.date.getDate()))].sort((a, b) => a - b);
            
            animatedChart.data.labels = dates.map(d => `Day ${d}`);
            animatedChart.data.datasets = topCompaniesForAnimation.map((company, index) => {
                const companyData = filteredData.filter(d => d.company === company[0]);
                const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'];
                
                return {
                    label: company[0].split(' ')[0],
                    data: dates.map(date => {
                        const dayData = companyData.find(d => d.date.getDate() === date);
                        return dayData ? dayData.close : null;
                    }),
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: false,
                    pointRadius: 3,
                    pointHoverRadius: 6,
                    pointBackgroundColor: colors[index],
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                };
            });
            animatedChart.update();

            // Update Stats
            const avgPrice = filteredData.reduce((sum, d) => sum + d.close, 0) / filteredData.length;
            const totalVolume = filteredData.reduce((sum, d) => sum + d.volume, 0);
            const trend = ((filteredData[filteredData.length - 1]?.close || 0) - (filteredData[0]?.close || 0)) / (filteredData[0]?.close || 1) * 100;

            document.getElementById('avgPrice').textContent = '$' + avgPrice.toFixed(2);
            document.getElementById('totalVolume').textContent = (totalVolume / 1000000000).toFixed(1) + 'B';
            document.getElementById('marketTrend').textContent = (trend >= 0 ? '+' : '') + trend.toFixed(1) + '%';
            document.getElementById('totalCompanies').textContent = [...new Set(filteredData.map(d => d.company))].length;
        }

        function refreshDashboard() {
            document.getElementById('loading').classList.add('active');
            setTimeout(() => {
                updateDashboard();
                document.getElementById('loading').classList.remove('active');
            }, 1000);
        }

        // Initialize on page load
        window.onload = function() {
            initCharts();
            updateDashboard();
            
            // Auto-refresh every 30 seconds
            setInterval(refreshDashboard, 30000);
        };

        // Add event listeners
        document.getElementById('monthSelect').addEventListener('change', updateDashboard);
        document.getElementById('industryFilter').addEventListener('change', updateDashboard);
    </script>
</body>
</html>